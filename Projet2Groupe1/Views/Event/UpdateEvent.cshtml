@model Projet2Groupe1.ViewModels.EventViewModel
@{
    Layout = "_LayoutDashboard";
    ViewBag.Title = "Profile de l'Admin !!";

    ViewBag.Role = "ORGANIZER";
}

@section DashNav {
    <ul>
        <li><a href=# class="buttonProfile"><img src="~/images/iconeOrganiser.png" alt="Icone Organiser" class="icone">Organiser événements</a></li>
        <li><a href=# class="buttonProfile"><img src="~/images/iconeTools.png" alt="Icone Tools" class="icone">Services demandés</a></li>
        <li><a href=# class="buttonProfile"><img src="~/images/iconeEuro.png" alt="Icone Euro" class="icone">Historique d'achat</a></li>
        <li><a href=# class="buttonProfile"><img src="~/images/iconeProfil.png" alt="Icone Profil" class="icone">Profil</a></li>
    </ul>
}

<h2>Manage Event</h2>
<head>
    <style>
        table {
            width: 60%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        tr.selected {
            background-color: #f0f8ff; 
        }

        button {
            padding: 5px 10px;
        }
    </style>
</head>
<form id="eventForm" method="post" action="@Url.Action("UpdateEvents", "Event")">

    <input type="hidden" id="eventId" name="Event.Id" />
    <input type="hidden" id="eventName" name="Event.NameEvent" />
    <input type="hidden" id="typeEvent" name="Event.TypeEvent" />
    <input type="hidden" id="startEvent" name="Event.StartEvent" />
    <input type="hidden" id="endEvent" name="Event.EndEvent" />
    <input type="hidden" id="artistName" name="Event.Artist.NickNameArtist" />

<table id="eventTable">
    <thead>
        <tr>
            <th>Image</th>
            <th>Nom de l'évenement</th>
            <th>Type Evenement</th>
            <th>Date de debut d'événement</th>
            <th>Date de fin d'événement</th>
            <th>Artiste</th>

        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Events)
        {
                <tr data-id="@item.Id">
                     <td> 
                         @{ 
                          String srcValue = "data:image.jpg;base64," + Convert.ToBase64String(@item.PhotoData) + ""; 


                         <img id="imgViewer" width="200" height="200" style="border:1px solid #000000" src=@srcValue /> 

                         }  
                     </td> 
                <td>@item.NameEvent</td>
                <td>@item.TypeEvent</td>
                <td>@item.StartEvent</td>
                <td>@item.EndEvent</td>
                <td>@item.Artist.NickNameArtist</td>

            </tr>
        }
    </tbody>
</table>
    <div style="text-align: center; margin-top: 20px;">
        <button type="button" id="editButton">Editer Evenement</button>
        <button type="button" id="deleteButton">Supprimer Evenement</button>
    </div>
</form>


<script>
       let selectedRow = null;
  
    document.querySelectorAll('#eventTable tbody tr').forEach(row => {
        row.addEventListener('click', function () {
            if (selectedRow) {
                selectedRow.classList.remove('selected');
            }

            
            selectedRow = this;
            this.classList.add('selected');
            const eventId = selectedRow.getAttribute('data-id');
            document.getElementById('eventId').value = eventId;
        });
    });

    
    document.getElementById('editButton').addEventListener('click', function (event) {
        document.getElementById('deleteButton').disabled=true;
        console.log('Selected Row:'+ selectedRow);
        if (!selectedRow) {
            alert('Selectionner un évenement a modifier');
            return;
        }

        const cells = selectedRow.querySelectorAll('td');

        if (this.textContent === 'Editer Evenement') {
            cells.forEach((cell, index) => {
                const currentValue = cell.innerText;
                if(index === 0) {

                }
                else if (index === 2) {
                    cell.innerHTML = `
                        <select>
                            <option value="CONCERT" ${currentValue === 'CONCERT' ? 'selected' : ''}>CONCERT</option>
                            <option value="FESTIVAL" ${currentValue === 'FESTIVAL' ? 'selected' : ''}>FESTIVAL</option>
                            <option value="SIGNINGSESSION" ${currentValue === 'SIGNINGSESSION' ? 'selected' : ''}>SIGNINGSESSION</option>
                        </select>
                    `;
                } else {
                    cell.innerHTML = `<input type="text" value="${currentValue}" />`;
                }
            });
               this.textContent = 'Enregistrer';
              } else {
            
            function updateHiddenFields(cells) {
                document.getElementById('eventName').value = cells[1].querySelector('input').value;
                document.getElementById('typeEvent').value = cells[2].querySelector('select').value;
                document.getElementById('startEvent').value = cells[3].querySelector('input').value;
                document.getElementById('endEvent').value = cells[4].querySelector('input').value;
                document.getElementById('artistName').value = cells[5].querySelector('input').value;
            }

            updateHiddenFields(cells);

            cells.forEach((cell, index) => {
                if (index > 0) {
                    if (index === 2) {
                        const select = cell.querySelector('select');
                        cell.innerHTML = select.value;
                    } else {
                        const input = cell.querySelector('input');
                        cell.innerHTML = input.value;
                    }
                }
            });

            document.getElementById('eventForm').submit();
            this.textContent = 'Editer Evenement';
            selectedRow.classList.remove('selected');
            selectedRow = null;
        }
        event.preventDefault();
    });
    document.getElementById('deleteButton').addEventListener('click', function () {
        if (!selectedRow) {
            alert('Selectionner un évenement à supprimer');
            return;
        }

        if (confirm('Voulez-vous vraiment supprimer cet événement?')) {
            document.getElementById('eventForm').action = '@Url.Action("DeleteEvent", "Event")';
            document.getElementById('eventForm').submit();
        }
    });

</script>

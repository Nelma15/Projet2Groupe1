
@using Projet2Groupe1.Models;
@using Projet2Groupe1.ViewModels;
@model List<Projet2Groupe1.Models.Event>
@{

    if ((bool)ViewData["IsAuthenticated"])
    {
        Layout = "_LayoutDashboard";
    }
    else
    {
        Layout = "_layoutHeaderFooter";
    }
    ViewBag.Title = "Catalogue";
}



<div class="search-container">
 @*    Méthode Get pour renvoyer les info nécessaires au tri géré par controller et service *@
    @using (Html.BeginForm("Catalog", "Event", FormMethod.Get))
	{
        <nav class="filters-wrapper">
            @Html.DropDownList("category", new SelectList(Enum.GetValues(typeof(TypeEvent))),
						        "Catégories",
                                new { onchange = "this.Form.submit()" })
            @Html.DropDownList("city", new SelectList(Model.Select(e => e.Adress.City).Distinct()),
						        "Villes", 
                                new { onchange = "this.Form.submit()" })
    
            <div class="search-bar">
                <!--premier mot entre "" renvoie au paramètre que je veux récupérer dans le controller -->
		            @Html.TextBox("search", null, new { placeholder = "Evenement, artiste " })
                <button type="submit" class="search-button">Rechercher</button>
             </div>
         </nav>
    }
</div>

<div class="events-container">
	
	
        @foreach (var eventItem in Model)
        {
        <div class="event-card">
            <section class="left-section">
			<div class="event-card-picture">
				
	    	@if (eventItem.PhotoData != null)
            {

                        String srcValue = "data:image.jpg;base64," + Convert.ToBase64String(eventItem.PhotoData);
                        <img class="event-card-image" width="300" height="200" style="border:1px solid #000000" src="@srcValue" />
             }
             else
             {
			 <img class="event-card-image" width="300" height="200" style="border:1px solid #000000" 
              src = "@Url.Action("GetDefaultImage", "Event", new { type = eventItem.TypeEvent })"/>
                      
             }
            </div>
                
            <div class="info-event">
                    <h2 class="event-card-title">@eventItem.NameEvent </h2>
                <p class="event-card-date">@eventItem.StartEvent.ToString("dd/MM/yyyy") - @eventItem.EndEvent.ToString("dd/MM/yyyy")</p>
			<p class="event-card-location">@eventItem.Adress.City</p>
            </div>
            </section>
             <section class="right-section">
                @if (eventItem?.Billetterie?.UnitPriceTicket != null)
                {
                    <p class="price"> à partir de  @eventItem.Billetterie.UnitPriceTicket €</p>
                }
                else
                {
                    <p class="price">Prix non disponible</p>
                }
                @Html.ActionLink("Réserver", "PurchaseTicket", "Ticket", new { id = eventItem.Id }, new { @class = "button" })
            </section>
        </div>
        }
         
 

      
      
            

</div>







